<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Yaniv Control Center</title>
  <link rel="stylesheet" href="control.css">
<!-- CC PWA + COMMANDS -->
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b1220">
<script>
(function(){
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js").catch(()=>{});
  }
})();
</script>

</head>
<body>
  <div class="wrap">
    <header class="top">
      <div class="brand">
        <h1>Yaniv Control Center</h1>
        <p>×›×¤×ª×•×¨×™× ×‘×¢×‘×¨×™×ª ×©××•×‘×™×œ×™× ×™×©×¨ ×œ×‘×™×¦×•×¢/×‘×“×™×§×” ×©×œ ××” ×©×‘× ×™× ×• ×‘×’×™×˜×”××‘.</p>
      </div>
      <div class="pill" id="pill">×¡×˜×˜×•×¡: ×œ× × ×‘×“×§</div>
    </header>

    <section class="grid">
      <div class="card">
        <h2>Hub ×—×™ ×¢×›×©×™×•</h2>
        <p>×‘×“×™×§×” ××”×™×¨×” ×©×œ Pages + ×¤×ª×™×—×” ×©×œ Hub / Summary / repos.json.</p>
        <div class="btns">
          <button class="btn good" onclick="CC.ping()">×‘×“×™×§×” ×¢×›×©×™×•</button>
          <button class="btn primary" onclick="CC.open(CC.urls.hub)">×¤×ª×— Hub</button>
          <button class="btn" onclick="CC.open(CC.urls.summary)">×¤×ª×— Summary</button>
          <button class="btn" onclick="CC.open(CC.urls.repos)">×¤×ª×— repos.json</button>
        </div>
      </div>

      <div class="card">
        <h2>×¨×¢× ×•×Ÿ Hub (×××™×ª×™)</h2>
        <p>×”×›×¤×ª×•×¨ ×¤×•×ª×— ××ª ×“×£ ×”-Workflow ×”× ×›×•×Ÿ. ×©× ×œ×•×—×¦×™× Run workflow.</p>
        <div class="btns">
          <button class="btn primary" onclick="CC.open(CC.urls.wf)">×¤×ª×— Workflow: Refresh Hub State</button>
          <button class="btn" onclick="CC.open(CC.urls.actions)">×¤×ª×— Actions</button>
          <button class="btn" onclick="CC.open(CC.urls.lastRun)">×¤×ª×— ×¨×™×¦×” ××—×¨×•× ×”</button>
        </div>
        <div class="hr"></div>
        <small class="mono">×˜×™×¤: ×‘×ª×•×š ×”-Workflow â†’ Run workflow â†’ Run.</small>
      </div>

      <div class="card">
        <h2>Issue ××•×›×Ÿ (×ª×™×¢×•×“/×‘×§×©×”)</h2>
        <p>×›×¤×ª×•×¨ ×©×™×•×¦×¨ Issue ×—×“×© ×¢× ×›×•×ª×¨×ª ××•×›× ×” ×œ×¨×¢× ×•×Ÿ/×‘×“×™×§×”.</p>
        <div class="btns">
          <button class="btn" onclick="CC.open(CC.urls.newIssue)">×¤×ª×— Issue ××•×›×Ÿ</button>
        </div>
      </div>

      <div class="card">
        <h2>×§×™×¦×•×¨×™ ×“×¨×š</h2>
        <p>×¤×ª×™×—×” ××”×™×¨×” ×©×œ Repo / Pages settings (×× ×¦×¨×™×š).</p>
        <div class="btns">
          <button class="btn" onclick="CC.open(CC.urls.repo)">×¤×ª×— Repo</button>
          <button class="btn" onclick="CC.open(CC.urls.pages)">×¤×ª×— Pages Settings</button>
        </div>
      </div>
    </section>

    <footer class="foot">
      <small class="mono" id="meta">â€”</small>
    </footer>
  </div>

  <script src="control.js"></script>
<div class="card">
  <h2>×¨×¢× ×•×Ÿ ××•×˜×•××˜×™ (Issue â†’ Actions â†’ Pages)</h2>
  <p>×›××Ÿ ×ª×¨××” ×”×•×›×—×” ×××™×ª×™×ª ×©×œ ×”×¨×¢× ×•×Ÿ ×”××—×¨×•×Ÿ.</p>
  <div class="hr"></div>
  <div class="mono" id="cc-last-refresh">×˜×•×¢×Ÿ ××¦×‘...</div>
  <div class="btns" style="margin-top:10px">
        <a class="btn primary" href="https://github.com/yanivmizrachiy/my-assistant/issues/new?template=control-refresh.yml" target="_blank" rel="noopener">×¤×ª×— Issue ×¨×¢× ×•×Ÿ (YES)</a>
    <button class="btn primary" onclick="CC.refreshNow()">×¨×¢× ×Ÿ ×¢×›×©×™×• (××•×˜×•××˜)</button>
    <button class="btn" onclick="CC.open(CC.urls.actions)">×¤×ª×— Actions</button>
    <button class="btn" onclick="CC.open(CC.urls.state)">×¤×ª×— refresh_state.json</button>
  </div>
</div>

<!-- AUTO REFRESH BUTTON -->
<div class="card" id="cc-auto-refresh" style="margin-top:14px">
  <h2>×¨×¢× ×•×Ÿ Hub</h2>
  <p>×‘×œ×™ ×”×§×œ×“×”: ×¤×•×ª×— Issue ××•×›×Ÿ (control + YES)</p>
  <a class="btn primary" target="_blank" rel="noopener"
     href="https://github.com/yanivmizrachiy/my-assistant/issues/new?labels=control&title=Refresh%20Hub&body=AUTO%3ACC_REFRESH%0AYES">ğŸ”„ ×¨×¢× ×Ÿ ×¢×›×©×™×•</a>
</div>

<!-- LIVE COMMANDS -->
<div class="card" id="cc-live-commands" style="margin-top:16px">
  <h2>ğŸ§  ×¤×§×•×“×•×ª ×—×™×•×ª</h2>
  <p>×”××¢×¨×›×ª ××’×™×‘×” ×œ×¤×§×•×“×•×ª ××™×œ×•×œ×™×•×ª ×•×©×•××¨×ª ×—×•×§×™× ×•×–×™×›×¨×•×Ÿ.</p>
  <ul>

      <!-- COMMAND CENTER CARD -->
  <div class="card cc-command-center-card" id="cc-command-center" style="margin-top:16px; border:2px solid #0066cc; background:#f0f8ff;">
    <h2>ğŸ›ï¸ ××¨×›×– ×¤×§×•×“×•×ª</h2>
    <p><strong>×”×¤×¢×œ ×¤×§×•×“×•×ª ××•×˜×•××˜×™×•×ª ×‘××¢×¨×›×ª</strong> | ×¤×§×•×“×•×ª: PING, REFRESH_HUB, PUBLISH_STATUS_NOW, ADD_NOTE, REBUILD_COMMANDS.</p>
    
    <a class="btn primary" 
       href="https://github.com/yanivmizrachiy/my-assistant/issues/new?template=command-center.yml&labels=control" 
       target="_blank" 
       rel="noopener">ğŸš€ ×¤×ª×— ××¨×›×– ×¤×§×•×“×•×ª (Issue)</a>
    
    <div class="mono" id="cc-last-cmd" style="margin-top:12px; font-size:0.9em; background:#e6f2ff; padding:8px; border-radius:4px;">
      <strong>×¤×§×•×“×” ××—×¨×•× ×”:</strong> <span id="lastCmdStatus">×˜×•×¢×Ÿ...</span><br>
      <span id="lastCmdDetails"></span>
    </div>
    
    <div style="margin-top:12px; font-size:0.85em; opacity:0.8;">
      ×§×™×©×•×¨×™×: 
      <a href="https://yanivmizrachiy.github.io/my-assistant/app/status/last-command.json" target="_blank">last-command.json</a> | 
      <a href="https://raw.githubusercontent.com/yanivmizrachiy/my-assistant/main/app/status/last-command.json" target="_blank">RAW</a> | 
      <a href="https://raw.githubusercontent.com/yanivmizrachiy/my-assistant/main/app/commands.json" target="_blank">commands.json</a> | 
      <a href="https://raw.githubusercontent.com/yanivmizrachiy/my-assistant/main/app/brain.json" target="_blank">brain.json</a>
    </div>
  </div>

  <script>
    // Load and display last command status
    (async function() {
      try {
        const res = await fetch('status/last-command.json?ts=' + Date.now());
        if (!res.ok) throw new Error('Not found');
        const data = await res.json();
        
        document.getElementById('lastCmdStatus').textContent = `${data.command} - ${data.status}`;
        document.getElementById('lastCmdDetails').innerHTML = `
          <small>
            ×–××Ÿ: ${new Date(data.timestamp).toLocaleString('he-IL')}<br>
            Issue: <a href="https://github.com/yanivmizrachiy/my-assistant/issues/${data.issue}" target="_blank">#${data.issue}</a> | 
            Run: <a href="https://github.com/yanivmizrachiy/my-assistant/actions/runs/${data.run_id}" target="_blank">${data.run_id}</a>
          </small>
        `;
      } catch (e) {
        document.getElementById('lastCmdStatus').textContent = '××™×Ÿ ×¢×“×™×™×Ÿ';
        document.getElementById('lastCmdDetails').innerHTML = '<small>×œ× ×‘×•×¦×¢×” ×¢×“×™×™×Ÿ ×¤×§×•×“×”. ×”×©×ª××© ×‘×›×¤×ª×•×¨ ×œ××¢×œ×” ×›×“×™ ×œ×”×ª×—×™×œ.</small>';
      }
    })();
  </script>
    <li>ğŸŸ¢ ××¦×‘ ×¨×’×™×œ</li>
    <li>ğŸ”´ ××¦×‘ ×—×™×¨×•× (××“×•× = ×¢×¦×•×¨ ×”×›×œ)</li>
  </ul>
</div>

<!-- CC DASHBOARD -->
<div class="card" id="cc-dashboard" style="margin-top:14px">
  <h2>×œ×•×— ×‘×§×¨×” ×—×™</h2>
  <p id="cc-status-line">×˜×•×¢×Ÿ ×¡×˜×˜×•×¡...</p>
  <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:10px">
    <a class="btn primary" target="_blank" rel="noopener"
       href="https://github.com/yanivmizrachiy/my-assistant/issues/new?labels=control&title=Refresh%20Hub&body=AUTO%3ACC_REFRESH%0AYES">ğŸ”„ ×¨×¢× ×•×Ÿ Hub</a>
    <a class="btn" target="_blank" rel="noopener"
       href="status/live.json?ts=1">ğŸ“¡ Live JSON</a>
    <a class="btn" target="_blank" rel="noopener"
       href="https://github.com/yanivmizrachiy/my-assistant/actions">âš™ï¸ Actions</a>
  </div>
  <pre id="cc-status-json" style="text-align:left;direction:ltr;max-height:260px;overflow:auto;margin-top:12px;background:#0b1220;color:#e6eefc;padding:12px;border-radius:14px;font-size:12px"></pre>
</div>
<script>
(async () => {
  try{
    const url = "status/live.json?ts=" + Date.now();
    const r = await fetch(url, {cache:"no-store"});
    const j = await r.json();
    const dt = new Date((j.updated_at||0)*1000);
    const ok = r.ok;
    document.getElementById("cc-status-line").textContent =
      (ok ? "âœ… " : "âŒ ") + "×¢×•×“×›×Ÿ: " + (isNaN(dt.getTime()) ? "×œ× ×™×“×•×¢" : dt.toLocaleString("he-IL"));
    document.getElementById("cc-status-json").textContent = JSON.stringify(j, null, 2);
  }catch(e){
    document.getElementById("cc-status-line").textContent = "âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×˜×˜×•×¡";
  }
})();
</script>

<!-- CC COMMAND PALETTE -->
<div class="card" id="cc-palette" style="margin-top:14px">
  <h2>×¤×§×•×“×•×ª ××”×™×¨×•×ª</h2>
  <p>×¤×ª×— ×—×™×¤×•×© ×¤×¢×•×œ×•×ª: <b>Ctrl+K</b> (×‘××—×©×‘) / ×—×™×¤×•×© ×‘×ª×•×š ×”×“×£ (×‘× ×™×™×“)</p>
  <div style="display:flex; gap:10px; flex-wrap:wrap">
    <a class="btn primary" target="_blank" rel="noopener" href="commands.json">âŒ˜ ×¤×ª×— ×¨×©×™××ª ×¤×¢×•×œ×•×ª</a>
    <a class="btn" target="_blank" rel="noopener" href="https://github.com/yanivmizrachiy/my-assistant/issues/new?labels=control&title=Refresh%20Hub&body=AUTO%3ACC_REFRESH%0AYES">ğŸ”„ ×¨×¢× ×Ÿ Hub (Issue ××•×›×Ÿ)</a>
    <a class="btn" target="_blank" rel="noopener" href="https://github.com/yanivmizrachiy/my-assistant/actions">âš™ï¸ Actions</a>
    <a class="btn" target="_blank" rel="noopener" href="status/live.json">ğŸ“¡ ×¡×˜×˜×•×¡ ×—×™</a>
  </div>
</div>

<div class="card" id="cc-live-status-card" style="margin-top:14px">
  <h2>×¡×˜×˜×•×¡ ×—×™</h2>
  <p id="cc-live-line">×˜×•×¢×Ÿâ€¦</p>
  <div style="display:flex; gap:10px; flex-wrap:wrap">
    <a class="btn" target="_blank" rel="noopener" href="status/live.json">×¤×ª×— live.json</a>
    <a class="btn" target="_blank" rel="noopener" href="https://github.com/yanivmizrachiy/my-assistant/actions/workflows/publish-live-status.yml">×”×¤×¢×œ / ×‘×“×•×§ Workflow</a>
  </div>
</div>

<script>
(async function(){
  const el = document.getElementById("cc-live-line");
  const url = "status/live.json" + "?ts=" + Date.now();
  try{
    const r = await fetch(url, {cache:"no-store"});
    const j = await r.json();
    const now = Math.floor(Date.now()/1000);
    const upd = Number(j.updated_at || 0);
    const diff = upd ? (now - upd) : null;
    const ago = (diff==null) ? "×œ× ×™×“×•×¢" :
      (diff < 60 ? `×œ×¤× ×™ ${diff} ×©× ×™×•×ª` :
       diff < 3600 ? `×œ×¤× ×™ ${Math.floor(diff/60)} ×“×§×•×ª` :
       `×œ×¤× ×™ ${Math.floor(diff/3600)} ×©×¢×•×ª`);
    const run = j?.workflows?.["publish-live-status"] || {};
    const runId = run.run_id || "";
    const runNum = run.run_number || "";
    el.textContent = `×¢×•×“×›×Ÿ ${ago} â€¢ ×¨×™×¦×” #${runNum} â€¢ run_id=${runId}`;
  }catch(e){
    el.textContent = "âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×¡×˜×˜×•×¡ ×—×™";
  }
})();
</script>

</body>
</html>
